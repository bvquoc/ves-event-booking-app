# VES Booking API

VES Booking API is a comprehensive Spring Boot application that provides both **Identity & Access Management** and **Event Booking** functionality. It handles user authentication, authorization, role-based access control (RBAC), and complete event booking lifecycle management.

## Features

### Identity & Access Management

- âœ… User management (CRUD operations)
- âœ… JWT-based authentication
- âœ… Role-based access control (RBAC)
- âœ… Permission management
- âœ… Token introspection and refresh
- âœ… Secure password hashing (BCrypt)

### Event Booking (In Development)

- ğŸš§ Event creation and management
- ğŸš§ Event booking and reservations
- ğŸš§ Booking status management
- ğŸš§ Event capacity and availability tracking
- ğŸš§ Booking history and reporting

## Tech Stack

- **Build Tool:** Maven >= 3.9.5
- **Language:** Java 21
- **Framework:** Spring Boot 3.2.2
- **Database:** MySQL 8.0
- **Security:** Spring Security + OAuth2 Resource Server
- **Mapping:** MapStruct 1.5.5
- **Validation:** Jakarta Validation

## Quick Start (Local Development)

### Prerequisites

- Java 21 SDK
- Docker & Docker Compose (for MySQL)
- Maven 3.9.5+ (or use included `./mvnw`)

### Step 1: Start MySQL Database

```bash
# Start MySQL using Docker Compose
docker compose up -d mysql

# Verify MySQL is running
docker compose ps
```

### Step 2: Start Application

```bash
# Using Maven wrapper (recommended)
./mvnw spring-boot:run

# OR using Maven
mvn spring-boot:run
```

### Step 3: Verify Application

- **Application URL:** `http://localhost:8080/api`
- **API Base Path:** `/api`

### Default Credentials

**Database (MySQL):**

- Host: `localhost:3306`
- Database: `ves_booking_api`
- Username: `root`
- Password: `root`

**Application Admin User (auto-created on first startup):**

- Username: `admin`
- Password: `admin`
- Role: `ADMIN`

âš ï¸ **Important:** Change the default admin password after first login!

### Quick Test

```bash
# Login as admin
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'
```

## Architecture

### Project Structure

```
ves-booking-api/
â”œâ”€â”€ src/main/java/com/uit/vesbookingapi/
â”‚   â”œâ”€â”€ configuration/     # Security, JWT, Application init
â”‚   â”œâ”€â”€ controller/         # REST endpoints
â”‚   â”‚   â”œâ”€â”€ AuthenticationController.java âœ…
â”‚   â”‚   â”œâ”€â”€ UserController.java âœ…
â”‚   â”‚   â”œâ”€â”€ RoleController.java âœ…
â”‚   â”‚   â”œâ”€â”€ PermissionController.java âœ…
â”‚   â”‚   â”œâ”€â”€ EventController.java ğŸš§ (to be implemented)
â”‚   â”‚   â””â”€â”€ BookingController.java ğŸš§ (to be implemented)
â”‚   â”œâ”€â”€ service/            # Business logic
â”‚   â”‚   â”œâ”€â”€ AuthenticationService.java âœ…
â”‚   â”‚   â”œâ”€â”€ UserService.java âœ…
â”‚   â”‚   â”œâ”€â”€ RoleService.java âœ…
â”‚   â”‚   â”œâ”€â”€ PermissionService.java âœ…
â”‚   â”‚   â”œâ”€â”€ EventService.java ğŸš§ (to be implemented)
â”‚   â”‚   â””â”€â”€ BookingService.java ğŸš§ (to be implemented)
â”‚   â”œâ”€â”€ repository/         # Data access layer
â”‚   â”‚   â”œâ”€â”€ UserRepository.java âœ…
â”‚   â”‚   â”œâ”€â”€ RoleRepository.java âœ…
â”‚   â”‚   â”œâ”€â”€ PermissionRepository.java âœ…
â”‚   â”‚   â”œâ”€â”€ EventRepository.java ğŸš§ (to be implemented)
â”‚   â”‚   â””â”€â”€ BookingRepository.java ğŸš§ (to be implemented)
â”‚   â”œâ”€â”€ entity/             # JPA entities
â”‚   â”‚   â”œâ”€â”€ User.java âœ…
â”‚   â”‚   â”œâ”€â”€ Role.java âœ…
â”‚   â”‚   â”œâ”€â”€ Permission.java âœ…
â”‚   â”‚   â”œâ”€â”€ InvalidatedToken.java âœ…
â”‚   â”‚   â”œâ”€â”€ Event.java ğŸš§ (to be implemented)
â”‚   â”‚   â””â”€â”€ Booking.java ğŸš§ (to be implemented)
â”‚   â”œâ”€â”€ dto/                # Data transfer objects
â”‚   â”‚   â”œâ”€â”€ request/        # Request DTOs
â”‚   â”‚   â””â”€â”€ response/      # Response DTOs
â”‚   â”œâ”€â”€ mapper/             # MapStruct mappers
â”‚   â”œâ”€â”€ exception/          # Exception handling
â”‚   â”œâ”€â”€ validator/         # Custom validators
â”‚   â””â”€â”€ constant/          # Constants
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yaml    # Main configuration
â”‚   â””â”€â”€ application-prod.yaml
â””â”€â”€ src/test/               # Test files
```

**Legend:**

- âœ… Implemented
- ğŸš§ In Development / To be implemented

### Database Schema

**Identity & Access Management Entities:**

- `User` - User accounts with roles
- `Role` - User roles (ADMIN, USER, etc.)
- `Permission` - Fine-grained permissions
- `InvalidatedToken` - Token blacklist for logout

**Event Booking Entities (To be implemented):**

- `Event` - Event information and details
- `Booking` - User event bookings/reservations
- `EventCategory` - Event categorization
- `Venue` - Event venue information (if applicable)

**Relationships:**

- User â†” Role: Many-to-Many
- Role â†” Permission: Many-to-Many
- User â†” Booking: One-to-Many (planned)
- Event â†” Booking: One-to-Many (planned)

### Security Architecture

- **Authentication:** JWT tokens
- **Authorization:** Role-based (RBAC)
- **Password:** BCrypt hashing (strength: 10)
- **Token Management:** Access tokens (1 hour) + Refresh tokens (10 hours)

## API Endpoints

Base URL: `http://localhost:8080/api`

### Authentication (`/api/auth`)

- `POST /auth/login` - Authenticate user
- `POST /auth/introspect` - Validate token
- `POST /auth/logout` - Invalidate token
- `POST /auth/refresh` - Refresh access token

### User Management (`/api/users`)

- `POST /users` - Create user
- `GET /users/{id}` - Get user by ID
- `GET /users/my-info` - Get current user info
- `PUT /users/{id}` - Update user
- `DELETE /users/{id}` - Delete user
- `GET /users` - List all users

### Role Management (`/api/roles`)

- `POST /roles` - Create role
- `GET /roles` - List all roles
- `DELETE /roles/{role}` - Delete role

### Permission Management (`/api/permissions`)

- `POST /permissions` - Create permission
- `GET /permissions` - List all permissions

### Event Booking (`/api/events`) - In Development

- ğŸš§ `POST /events` - Create event
- ğŸš§ `GET /events` - List all events
- ğŸš§ `GET /events/{id}` - Get event details
- ğŸš§ `PUT /events/{id}` - Update event
- ğŸš§ `DELETE /events/{id}` - Delete event
- ğŸš§ `GET /events/{id}/availability` - Check event availability

### Booking Management (`/api/bookings`) - In Development

- ğŸš§ `POST /bookings` - Create booking
- ğŸš§ `GET /bookings` - List user bookings
- ğŸš§ `GET /bookings/{id}` - Get booking details
- ğŸš§ `PUT /bookings/{id}/cancel` - Cancel booking
- ğŸš§ `GET /bookings/my-bookings` - Get current user's bookings

## Configuration

### Application Configuration

**Server:**

- Port: `8080`
- Context Path: `/api`

**Database:**

- URL: `jdbc:mysql://localhost:3306/ves_booking_api`
- Username: `root` (default)
- Password: `root` (default)
- DDL Mode: `update` (auto-create/update tables)

**JWT:**

- Access Token Validity: 3600 seconds (1 hour)
- Refresh Token Validity: 36000 seconds (10 hours)

### Environment Variables

Override database settings:

```bash
export DBMS_CONNECTION=jdbc:mysql://localhost:3306/ves_booking_api
export DBMS_USERNAME=root
export DBMS_PASSWORD=root
```

## Build Application

```bash
# Clean and compile
./mvnw clean compile

# Run tests
./mvnw test

# Package application
./mvnw clean package

# Run JAR
java -jar target/ves-booking-api-0.0.1.jar
```

## Docker Deployment

### Build Docker Image

```bash
docker build -t ves-booking-api:0.9.0 .
```

### Run with Docker Compose

```bash
# Start MySQL and application
docker compose up -d

# View logs
docker compose logs -f

# Stop services
docker compose down
```

### Manual Docker Deployment

```bash
# Create network
docker network create ves-booking-network

# Start MySQL
docker run --network ves-booking-network --name mysql \
  -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=root \
  -e MYSQL_DATABASE=ves_booking_api \
  -d mysql:8.0

# Run application
docker run --name ves-booking-api \
  --network ves-booking-network \
  -p 8080:8080 \
  -e DBMS_CONNECTION=jdbc:mysql://mysql:3306/ves_booking_api \
  -e DBMS_USERNAME=root \
  -e DBMS_PASSWORD=root \
  ves-booking-api:0.9.0
```

### Push to Docker Hub

```bash
docker tag ves-booking-api:0.9.0 <account>/ves-booking-api:0.9.0
docker push <account>/ves-booking-api:0.9.0
```

## Development Resources

- **Local Setup Guide:** See [LOCAL_SETUP.md](./LOCAL_SETUP.md) for detailed local development instructions
- **Postman Collection:** Import `Identity Service.postman_collection.json` for API testing
- **API Documentation:** Check `API-DOCS.md` in parent directory
- **Source Code:** Explore `src/main/java/com/uit/vesbookingapi/` for implementation details
